(function($){$.widget('ui.numeric',{version:'1.4.2',options:{disabled:false,keyboard:true,showCurrency:false,currencySymbol:null,title:null,buttons:true,upButtonIcon:'ui-icon-triangle-1-n',upButtonTitle:null,downButtonIcon:'ui-icon-triangle-1-s',downButtonTitle:null,emptyValue:0,minValue:false,maxValue:false,smallIncrement:1,increment:5,largeIncrement:10,calc:null,format:null},_adjustmentFlag:false,_keyDownFlag:false,_timer:null,_name:'numeric',_value:0,_create:function(){var type=this.element.attr('type').toLowerCase();if(type!=='text'&&type!=='number')throw'numeric widget can only be applied to text and number inputs.';this._checkFormat();this._name=this.element.attr('id')||this.element.attr('name');this._value=this._getInputValue(this.element.attr('value'),true);if(this.options.minValue!==false&&this._value<this.options.minValue)this._value=this.options.minValue;if(this.options.maxValue!==false&&this._value>this.options.maxValue)this._value=this.options.maxValue;this.element.attr('value',this._format(this._value));this.element.attr('title',this.options.title||$.ui.numeric.globalization.defaultTooltip).wrap($('<div class="ui-widget ui-widget-content ui-corner-all ui-numeric" />'));if(this.options.showCurrency)this._createCurrency();if(this.options.buttons)this._createButtons();var self=this;this.element.bind({keydown:function(event){return self._onKeyDown(event)},keyup:function(event){return self._onKeyUp(event)},change:function(event){return self._onChange(event)}});if(this.options.disabled||this.element.attr('disabled'))this._setOption('disabled',true);$(window).bind('unload',function(){self.destroy()})},destroy:function(){var self=this;this.element.unbind({keydown:function(event){return self._onKeyDown(event)},keyup:function(event){return self._onKeyUp(event)},change:function(event){return self._onChange(event)}});if(this.options.showCurrency)$('#'+this._name+'_currency').remove();if(this.options.buttons)$('#'+this._name+'_buttons').remove();this.element.unwrap();$.Widget.prototype.destroy.call(this);$(window).unbind('unload',function(){self.destroy()})},_createCurrency:function(){this.element.before($('<div/>').attr('id',this._name+'_currency').addClass('ui-numeric-currency').html(this.options.currencySymbol||Number.globalization.defaultCurrencyFormat.symbol))},_createButtons:function(){var btnUp=$('<button type="button"></button>').attr('title',this.options.upButtonTitle||$.ui.numeric.globalization.defaultUpTooltip).bind({keydown:function(event){keydown(event,false)},keyup:function(){up()},mousedown:function(event){down(event,false)},mouseup:function(){up()}}).button({text:false,label:'U',icons:{primary:this.options.upButtonIcon}});var btnDown=$('<button type="button"></button>').attr('title',this.options.downButtonTitle||$.ui.numeric.globalization.defaultDownTooltip).bind({keydown:function(event){keydown(event,true)},keyup:function(){up()},mousedown:function(event){down(event,true)},mouseup:function(){up()}}).button({text:false,label:'D',icons:{primary:this.options.downButtonIcon}});this._addButtons(btnUp,btnDown);var self=this;function keydown(event,neg){if(event.which==32||event.which==13){down(event,neg);event.target.focus()}}function down(event,neg){(neg?btnUp:btnDown).blur();var inc=self._getIncrement(event.ctrlKey,event.shiftKey);self._adjustValueRecursive(neg?-inc.value:inc.value,inc.type)}function up(){clearTimeout(self._timer)}},_addButtons:function(btnUp,btnDown){this.element.after($('<div/>').attr('id',this._name+'_buttons').addClass('ui-numeric-buttons').append(btnUp).append(btnDown))},_setOption:function(key,value){switch(key){case'disabled':this.element.parent()[value?'addClass':'removeClass']('ui-numeric-disabled ui-state-disabled').attr('aria-disabled',value);this._adjustmentFlag=true;if(value)this.element.attr({disabled:'disabled',value:''});else this.element.removeAttr('disabled').attr('value',this._format(this._value));this._adjustmentFlag=false;if(this.options.buttons)$('#'+this._name+'_buttons button').button(value?'disable':'enable');break;case'emptyValue':this.options.emptyValue=value;this._setValue(this._value);break;case'minValue':this.options.minValue=value===false?false:_numVal(value);if(this.options.minValue!==false&&this._value<this.options.minValue)this._setValue(this.options.minValue);break;case'maxValue':this.options.maxValue=value===false?false:_numVal(value);if(this.options.maxValue!==false&&this._value>this.options.maxValue)this._setValue(this.options.maxValue);break;case'format':this.options.format=value;this._checkFormat();this._setValue(this._value);break;case'title':this.options.title=value||$.ui.numeric.globalization.defaultTooltip;this.element.attr('title',this.options.title);break;case'showCurrency':if(value&&!this.options.showCurrency)this._createCurrency();else if(!value&&this.options.showCurrency)$('#'+this._name+'_currency').remove();this.options.showCurrency=value;break;case'currencySymbol':this.options.currencySymbol=value||Number.globalization.defaultCurrencyFormat.symbol;if(this.options.showCurrency)$('#'+this._name+'_currency').html(this.options.currencySymbol);break;case'buttons':if(value&&!this.options.buttons)this._createButtons();else if(!value&&this.options.buttons)$('#'+this._name+'_buttons').remove();this.options.buttons=value;break;case'upButtonIcon':this.options.upButtonIcon=value;if(this.options.buttons)$('#'+this._name+'_buttons').find('button:eq(0)').button('option','icons',{primary:value});break;case'upButtonTitle':this.options.upButtonTitle=value||$.ui.numeric.globalization.defaultUpTooltip;if(this.options.buttons)$('#'+this._name+'_buttons').find('button:eq(0)').attr('title',this.options.upButtonTitle);break;case'downButtonIcon':this.options.downButtonIcon=value;if(this.options.buttons)$('#'+this._name+'_buttons').find('button:eq(1)').button('option','icons',{primary:value});break;case'downButtonTitle':this.options.downButtonTitle=value||$.ui.numeric.globalization.defaultDownTooltip;if(this.options.buttons)$('#'+this._name+'_buttons').find('button:eq(1)').attr('title',this.options.downButtonTitle);break;default:$.Widget.prototype._setOption.call(this,key,value);break}return this},_checkFormat:function(){this.options.format=$.extend({},Number.globalization.defaultFormat,typeof this.options.format==='string'?{format:this.options.format}:this.options.format)},_getInputValue:function(val,parse){val=val.replace(new RegExp(regExEscape(this.options.format.thousandsChar),'g'),'');if(this.options.format.decimalChar!=='.')val=val.replace(new RegExp(regExEscape(this.options.format.decimalChar),'g'),'.');return parse?_numVal(val):val},_setInputValue:function(val){this._adjustmentFlag=true;this.element.attr('value',this._format(val)).change();this._adjustmentFlag=false},_setValue:function(val){val=_numVal(val);if(this.options.minValue!==false&&val<this.options.minValue)val=this.options.minValue;if(this.options.maxValue!==false&&val>this.options.maxValue)val=this.options.maxValue;this._value=val;if(!this.options.disabled)this._setInputValue(val)},_format:function(val){return isNaN(val)||(this.options.emptyValue!==false&&val===this.options.emptyValue)?'':$.formatNumber(val,this.options.format)},_getIncrement:function(ctrl,shift){if(ctrl)return{value:this.options.smallIncrement,type:2};else if(shift)return{value:this.options.largeIncrement,type:3};return{value:this.options.increment,type:1}},_adjustValue:function(amount,type){if(this.options.disabled)return;this._setValue($.isFunction(this.options.calc)?this.options.calc(this._value,type,amount<0?2:1):this._value+amount);this.select()},_adjustValueRecursive:function(amount,type){$.ui.numeric._current=this;$.ui.numeric._timerCallback(amount,type,true)},_onKeyDown:function(event){if(this.options.disabled)return;var v_char=String.fromCharCode($.keyCodeToCharCode(event.which,event.shiftKey)).toLowerCase();if(v_char===this.options.format.decimalChar.toLowerCase()||v_char==this.options.format.thousandsChar.toLowerCase()){this._keyDownFlag=true;return}switch(event.which){case 109:this._keyDownFlag=true;return;case 38:case 40:if(this.options.keyboard){var inc=this._getIncrement(event.ctrlKey,event.shiftKey);this._adjustValue(event.which==40?-inc.value:inc.value,inc.type)}return;case 33:if(this.options.keyboard)this._adjustValue(this.options.largeIncrement,3);return;case 34:if(this.options.keyboard)this._adjustValue(-this.options.largeIncrement,3);return;case 65:case 67:case 86:case 88:case 89:case 90:if(event.ctrlKey)return;break}if(isControlKey(event.which))return;if(!isNumericKey(event.which)){event.preventDefault();event.stopPropagation();return}},_onKeyUp:function(){var v=parseFloat(this._getInputValue(this.element.attr('value'),false));if(!isNaN(v))this._value=v;this._keyDownFlag=false},_onChange:function(event){if(!this._adjustmentFlag&&!this._keyDownFlag)this._setValue(this._getInputValue(event.target.value),true)},value:function(val){if(val===undefined)return this._value;this._setValue(val);return this},select:function(){if(!this.options.disabled)this.element.select();return this}});$.ui.numeric.globalization={defaultTooltip:'Type a new value or use the buttons or keyboard arrow keys to change the value. Hold Ctrl or Shift for a smaller or larger increment, respectively.',defaultUpTooltip:'Increment the value. Hold Ctrl or Shift for a smaller or larger increment, respectively.',defaultDownTooltip:'Decrement the value. Hold Ctrl or Shift for a smaller or larger increment, respectively.'};$.ui=$.ui||{};$.ui.numeric._current=null;$.ui.numeric._timerCallback=function(amount,type,first){clearTimeout($.ui.numeric._current._timer);$.ui.numeric._current._adjustValue(amount,type);$.ui.numeric._current._timer=setTimeout('jQuery.ui.numeric._timerCallback('+amount+','+type+',false)',first?1000:50)}var KEY_CODE_MAP_SHIFT={48:41,49:33,50:64,51:35,52:36,53:37,54:94,55:38,56:42,57:40,59:58,61:43,186:58,187:43,188:60,109:95,189:95,190:62,191:63,192:126,219:123,220:124,221:125,222:34};var KEY_CODE_MAP_NORMAL={59:59,61:61,96:48,97:49,98:50,99:51,100:52,101:53,102:54,103:55,104:56,105:57,106:42,107:43,109:45,110:46,111:47,186:59,187:61,188:44,109:45,189:45,190:46,191:47,192:96,219:91,220:92,221:93,222:39};$.keyCodeToCharCode=function(keyCode,shift){if(keyCode>=48&&keyCode<=57&&!shift)return keyCode;if(keyCode>=65&&keyCode<=90)return shift?keyCode:keyCode+32;if(keyCode===9||keyCode===32)return keyCode;return shift?KEY_CODE_MAP_SHIFT[keyCode]:KEY_CODE_MAP_NORMAL[keyCode]}function isControlKey(keyCode){return(keyCode<=47&&keyCode!=32)||(keyCode>=91&&keyCode<=95)||(keyCode>=112&&[188,190,191,192,219,220,221,222].indexOf(keyCode)==-1)}function isNumericKey(keyCode){return(keyCode>=48&&keyCode<=57)||(keyCode>=96&&keyCode<=105)}function _numVal(val){if(typeof val!=='number')val=Number(val);if(isNaN(val))return 0;return val}function replicate(str,count){var v_retval='';for(var i=0;i<count;i++)v_retval+=str;return v_retval}var REGEX_ESCAPE=new RegExp('(\\'+['/','.','*','+','?','|','(',')','[',']','{','}','\\'].join('|\\')+')','g');function regExEscape(val){return val.replace(REGEX_ESCAPE,'\\$1')}$.formatNumber=function(num,options){options=$.extend({},Number.globalization.defaultFormat,typeof options==='string'?{format:options}:options);options.decimalChar=typeof options.decimalChar!=='string'||options.decimalChar.length<=0?Number.globalization.defaultFormat.decimalChar:options.decimalChar;options.thousandsChar=typeof options.thousandsChar!=='string'?Number.globalization.defaultFormat.thousandsChar:options.thousandsChar;if(options.decimalChar.length>1)throw'NumberFormatException: Can not have multiple characters as the decimal character.';if(options.thousandsChar.length>1)throw'NumberFormatException: Can not have multiple characters as the thousands separator.';if(typeof num!=='number'){if(typeof num==='string'){num=num.replace(new RegExp(regExEscape(options.thousandsChar),'g'),'');if(options.decimalChar!=='.')num=num.replace(new RegExp(regExEscape(options.decimalChar),'g'),'.')}num=Number(num);if(isNaN(num))num=0}if(typeof options.format!=='string'||options.format.length<=0)return options.decimalChar==='.'?num.toString():num.toString().replace(/\./g,options.decimalChar);var v_dec_index=options.format.indexOf('.');if(v_dec_index>=0&&options.format.indexOf('.',v_dec_index+1)>=0)throw'NumberFormatException: Format string has multiple decimal characters.';var v_num_as_string=num.toString().replace(/-/g,''),v_clean_format=options.format.replace(new RegExp('[^0#\.]','g'),''),v_num_parts=v_num_as_string.indexOf('.')<0?[v_num_as_string,'']:v_num_as_string.split('.'),v_format_parts=v_dec_index<0?[v_clean_format,'']:v_clean_format.split('.');if(parseInt(num)===0)v_num_parts[0]=v_format_parts[0].indexOf('0')>=0?Number.globalization.padChar:'';var i;if(options.format.indexOf(',')>=0&&v_num_parts[0].length>3){var v_int_thousands_array=[],j=v_num_parts[0].length,m=Math.floor(j/3),n=v_num_parts[0].length%3||3;for(i=0;i<j;i+=n){if(i!=0)n=3;v_int_thousands_array[v_int_thousands_array.length]=v_num_parts[0].substr(i,n);m-=1}v_num_parts[0]=v_int_thousands_array.join(options.thousandsChar)}if(v_format_parts[1].length>0){if(v_num_parts[1].length>0){if(v_num_parts[1].length>v_format_parts[1].length)v_num_parts[1]=Number('0.'+v_num_parts[1]).roundRight(v_format_parts[1].length).toString().split('.')[1];if(typeof(v_num_parts[1])==="undefined"){v_num_parts[1]=Number(0).padRight(v_format_parts[1].length)}var v_format_array=v_format_parts[1].split(''),v_dec_part_array=v_num_parts[1].split('');for(i=0;i<v_dec_part_array.length;i++){if(i>=v_format_array.length)break;v_format_array[i]=v_dec_part_array[i]}v_num_parts[1]=v_format_array.join('').replace(/#/g,'')}else{var v_index=0;v_num_parts[1]='';while(v_format_parts[1].charAt(v_index)==='0'){v_num_parts[1]+=Number.globalization.padChar;v_index++}}}else v_num_parts[1]='';var v_retval=(v_num_parts[1].length<=0)?v_num_parts[0]:v_num_parts[0]+options.decimalChar+v_num_parts[1];if(num<0)v_retval='-'+v_retval;return options.format.replace(new RegExp('[0|#|,|\.]+'),v_retval)}Number.prototype.roundRight=function(numberOfDecimals){numberOfDecimals=_numVal(numberOfDecimals);var v_pow=Math.pow(10,numberOfDecimals);return Math.round(this*v_pow)/v_pow}Number.prototype.pad=function(numberOfDigits){numberOfDigits=_numVal(numberOfDigits);var v_string=String(this.valueOf()),v_s_len=v_string.length;if(v_s_len<numberOfDigits){for(var i=v_s_len;i<numberOfDigits;i++)v_string=Number.globalization.padChar+v_string}return v_string}Number.prototype.padRight=function(numberOfDigits){numberOfDigits=_numVal(numberOfDigits);var v_string=String(this.valueOf()),v_s_len=v_string.length-(this%1>0?1:0);if(v_s_len<numberOfDigits){for(var i=v_s_len;i<numberOfDigits;i++)v_string=v_string+Number.globalization.padChar}return v_string}Number.prototype.padDecimals=function(numberOfDecimals){numberOfDecimals=_numVal(numberOfDecimals);var v_parts=String(this.valueOf()).split('.');if(v_parts.length<=0)return numberOfDecimals>0?Number.globalization.padChar+'.'+replicate(Number.globalization.padChar,numberOfDecimals):Number.globalization.padChar;if(v_parts.length==1)return v_parts[0]+(numberOfDecimals>0?'.'+replicate(Number.globalization.padChar,numberOfDecimals):'');return v_parts[0]+(numberOfDecimals>0?'.'+parseInt(v_parts[1]).padRight(numberOfDecimals):'')}Number.prototype.getOrdinal=function(){if(this>100)return(this%100).getOrdinal();if(this>=11&&this<=19)return Number.globalization.ordinals.th;switch(this%10){case 1:return Number.globalization.ordinals.st;case 2:return Number.globalization.ordinals.nd;case 3:return Number.globalization.ordinals.rd}return Number.globalization.ordinals.th}Number.prototype.format=function(options){$.formatNumber(this,options)}Number.prototype.formatCurrency=function(options){options=$.extend({},Number.globalization.defaultCurrencyFormat,options);var v_retval=Math.abs(this).format(options);if(this<0)return options.noParens?'-'+options.symbol+v_retval:'('+options.symbol+v_retval+')';return v_retval}Number.globalization={defaultFormat:{format:null,decimalChar:'.',thousandsChar:','},defaultCurrencyFormat:{symbol:'$',noParens:false,format:'#,##0.00',decimalChar:'.',thousandsChar:','},padChar:'0',ordinals:{th:'th',st:'st',nd:'nd',rd:'rd'}}})(jQuery);